:table-caption!:
:example-caption!:
:source-highlighter: prettify
:sectids!:
[[io__couponservice]]
= CouponService

This service class contains functions related to coupons in the basket. +
All public functions are available in the Twig template renderer.



===== Namespace

`IO\Services`




.Constants
|===
|Type |Name |Value |Description

|link:http://php.net/int[int^]
a|`BELOW_MINIMAL_ORDER_VALUE`
|301
|
|link:http://php.net/int[int^]
a|`NO_VALID_ITEM_IN_BASKET`
|302
|
|===


.Properties
|===
|Type |Name |Description

|xref:stable7@interface::Order.adoc#order_contracts_couponcampaignrepositorycontract[`CouponCampaignRepositoryContract`]
a|`$couponCampaignRepository`
||xref:stable7@interface::Basket.adoc#basket_contracts_basketrepositorycontract[`BasketRepositoryContract`]
a|`$basketRepository`
||xref:stable7@interface::Item.adoc#item_contracts_variationcategoryrepositorycontract[`VariationCategoryRepositoryContract`]
a|`$variationCategoryRepository`
||xref:stable7@interface::Authorization.adoc#authorization_services_authhelper[`AuthHelper`]
a|`$authHelper`
|
|===


===== Methods

[source%nowrap, php, subs=+macros]
[#__construct]
----

public __construct($couponCampaignRepository, $basketRepository, $variationCategoryRepository, $authHelper)

----





CouponService constructor.

.*Parameters*
|===
|Type |Name |Description
|xref:stable7@interface::Order.adoc#order_contracts_couponcampaignrepositorycontract[`CouponCampaignRepositoryContract`]
a|`$couponCampaignRepository`
|

|xref:stable7@interface::Basket.adoc#basket_contracts_basketrepositorycontract[`BasketRepositoryContract`]
a|`$basketRepository`
|

|xref:stable7@interface::Item.adoc#item_contracts_variationcategoryrepositorycontract[`VariationCategoryRepositoryContract`]
a|`$variationCategoryRepository`
|

|xref:stable7@interface::Authorization.adoc#authorization_services_authhelper[`AuthHelper`]
a|`$authHelper`
|
|===


[source%nowrap, php, subs=+macros]
[#setcoupon]
----

public setCoupon($couponCode):xref:stable7@interface::Basket.adoc#basket_models_basket[Basket]

----





Setter for couponCode

.*Parameters*
|===
|Type |Name |Description
|link:http://php.net/string[`string`^]
a|`$couponCode`
|Code representing a coupon
|===


[source%nowrap, php, subs=+macros]
[#removecoupon]
----

public removeCoupon($code = null):xref:stable7@interface::Basket.adoc#basket_models_basket[Basket]

----





Remove the coupon code from the basket and optionally throw a notification with a code.

.*Parameters*
|===
|Type |Name |Description
|link:http://php.net/int[`int`^]
a|`$code`
|Optional: Error code for notification
|===


[source%nowrap, php, subs=+macros]
[#checkcoupon]
----

public checkCoupon($basket):link:http://php.net/array[array^]

----





Get a basket with applied coupon discounts

.*Parameters*
|===
|Type |Name |Description
|link:http://php.net/array[`array`^]
a|`$basket`
|The basket
|===


[source%nowrap, php, subs=+macros]
[#validatebasketitemdelete]
----

public validateBasketItemDelete($basket, $basketItem)

----

[WARNING]
.Deprecated! 
====

since 5.0.9. Validation is handled b the plentymarkets core from now.

====




Validate the basket for the coupon, and remove the coupon if invalid

.*Parameters*
|===
|Type |Name |Description
|xref:stable7@interface::Basket.adoc#basket_models_basket[`Basket`]
a|`$basket`
|The basket

|link:http://php.net/array[`array`^]
a|`$basketItem`
|Current basketItem
|===


[source%nowrap, php, subs=+macros]
[#validatebasketitemupdate]
----

public validateBasketItemUpdate($basket, $data, $basketItem)

----

[WARNING]
.Deprecated! 
====

since 5.0.9. Validation is handled b the plentymarkets core from now.

====




Validate the basket for the coupon, and remove the coupon if invalid

.*Parameters*
|===
|Type |Name |Description
|xref:stable7@interface::Basket.adoc#basket_models_basket[`Basket`]
a|`$basket`
|The Basket

|link:http://php.net/array[`array`^]
a|`$data`
|New basketItem

|link:http://php.net/array[`array`^]
a|`$basketItem`
|Current basketItem
|===


[source%nowrap, php, subs=+macros]
[#effectsonshippingcosts]
----

public effectsOnShippingCosts($campaign):link:http://php.net/bool[bool^]

----





Checks, if the coupon&#039;s discount changes shipping costs.

.*Parameters*
|===
|Type |Name |Description
|xref:stable7@interface::Order.adoc#order_models_couponcampaign[`CouponCampaign`]
a|`$campaign`
|Contains information about the campaign
|===


